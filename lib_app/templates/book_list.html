{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">Books</h1>

<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th>Status</th>
      <th style="width: 260px;">Actions</th>
    </tr>
  </thead>

  <tbody>
    {% for book in books %}
      <tr>
        <td>
          <a href="{{ url_for('main.book_detail', book_id=book.id) }}">
            {{ book.title }}
          </a>
        </td>

        <td>{{ book.author }}</td>

        <td>
          {% if book.available %}
            <span class="badge bg-success">Available</span>
          {% else %}
            <span class="badge bg-secondary">Borrowed</span>
          {% endif %}
        </td>

        <td>
          {# ===== USER ACTIONS ===== #}
          {% if current_user.is_authenticated and current_user.role == "user" %}

            {% if book.available %}
              <form method="post"
                    action="{{ url_for('main.borrow_book', book_id=book.id) }}"
                    style="display:inline;">
                <button class="btn btn-sm btn-primary">
                  Borrow
                </button>
              </form>
            {% else %}
              <form method="post"
                    action="{{ url_for('main.return_book', book_id=book.id) }}"
                    style="display:inline;">
                <button class="btn btn-sm btn-warning">
                  Return
                </button>
              </form>
            {% endif %}

          {% endif %}

          {# ===== LIBRARIAN ACTIONS ===== #}
          {% if current_user.is_authenticated and current_user.role == "librarian" %}

            <a href="{{ url_for('main.edit_book', book_id=book.id) }}"
               class="btn btn-sm btn-outline-secondary">
              Edit
            </a>

            <form method="post"
                  action="{{ url_for('main.delete_book', book_id=book.id) }}"
                  style="display:inline;"
                  onsubmit="return confirm('Are you sure you want to delete this book?');">
              <button class="btn btn-sm btn-danger">
                Delete
              </button>
            </form>

          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% if books|length == 0 %}
  <p class="text-muted">No books found.</p>
{% endif %}

{% endblock %}
