{% extends "base.html" %}
{% block content %}
<h1>Books</h1>

<form class="row mb-3" method="get" action="{{ url_for('main.index') }}">
  <div class="col-sm-6">
    <input class="form-control" name="q" value="{{ q }}" placeholder="Search by title or author...">
  </div>
  <div class="col-auto">
    <button class="btn btn-secondary">Search</button>
  </div>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Author</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for book in books %}
      <tr>
        <td>
          <a href="{{ url_for('main.book_detail', book_id=book.id) }}">
            {{ book.title }}
          </a>
        </td>
        <td>{{ book.author }}</td>
        <td>{{ "Available" if book.available else "Borrowed" }}</td>
        <td>
        {% if book.available and current_user.is_authenticated %}
          <form method="post"
                action="{{ url_for('main.borrow_book', book_id=book.id) }}"
                style="display:inline;">
            <button class="btn btn-sm btn-primary">Borrow</button>
          </form>

        {% elif not book.available and current_user.is_authenticated %}
          <form method="post"
                action="{{ url_for('main.return_book', book_id=book.id) }}"
                style="display:inline;">
            <button class="btn btn-sm btn-warning">Return</button>
          </form>
        {% endif %}

        {% if current_user.is_authenticated and current_user.role == 'librarian' %}
          <a class="btn btn-sm btn-outline-secondary"
            href="{{ url_for('main.edit_book', book_id=book.id) }}">
            Edit
          </a>

          <form method="post"
                action="{{ url_for('main.delete_book', book_id=book.id) }}"
                style="display:inline;"
                onsubmit="return confirm('Are you sure you want to delete this book?');">
            <button class="btn btn-sm btn-danger">Delete</button>
          </form>
        {% endif %}

      </td>

      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
